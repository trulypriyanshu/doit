<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    
    <!-- PWA Theme & Colors -->
    <meta name="theme-color" content="#4f46e5" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="CarryOut" />
    <meta name="application-name" content="CarryOut" />
    <meta name="mobile-web-app-capable" content="yes" />
    
    <!-- SEO & PWA Metadata -->
    <meta name="description" content="CarryOut - Your smart task management companion with recurring tasks, checklists, and productivity insights" />
    <meta name="keywords" content="task manager, todo list, productivity, recurring tasks, checklist, time management" />
    <meta name="author" content="CarryOut Team" />
    
    <!-- Social Media Sharing -->
    <meta property="og:title" content="CarryOut - Smart Task Manager" />
    <meta property="og:description" content="Organize your tasks efficiently with recurring tasks, checklists, and smart productivity features" />
    <meta property="og:image" content="%PUBLIC_URL%/og-image.png" />
    <meta property="og:url" content="https://carryout.app" />
    <meta property="og:type" content="website" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="CarryOut - Smart Task Manager" />
    <meta name="twitter:description" content="Organize your tasks efficiently with recurring tasks, checklists, and smart productivity features" />
    <meta name="twitter:image" content="%PUBLIC_URL%/twitter-image.png" />
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="%PUBLIC_URL%/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="%PUBLIC_URL%/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="%PUBLIC_URL%/favicon-16x16.png" />
    <link rel="mask-icon" href="%PUBLIC_URL%/safari-pinned-tab.svg" color="#4f46e5" />
    
    <!-- Manifest -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" crossorigin="use-credentials" />
    
    <!-- Splash Screen for iOS -->
    <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />
    <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />
    <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" />
    <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" />
    <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-1536x2048.png" media="(min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)" />
    <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-1668x2224.png" media="(min-device-width: 834px) and (max-device-width: 834px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)" />
    <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-2048x2732.png" media="(min-device-width: 1024px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)" />
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Web App Title -->
    <title>CarryOut â€¢ Smart Task Manager</title>
    
    <!-- Service Worker Registration Script -->
    <script>
      // Register service worker for PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/service-worker.js').then(
            function(registration) {
              console.log('ServiceWorker registration successful with scope: ', registration.scope);
            },
            function(err) {
              console.log('ServiceWorker registration failed: ', err);
            }
          );
        });
      }
      
      // Theme detection and safe area handling
      (function() {
        // Detect preferred color scheme
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        
        // Handle safe areas for mobile devices
        function updateSafeArea() {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        // Initial call
        updateSafeArea();
        
        // Update on resize
        window.addEventListener('resize', updateSafeArea);
        window.addEventListener('orientationchange', updateSafeArea);
        
        // Add dark mode class if preferred
        if (prefersDarkScheme.matches) {
          document.documentElement.classList.add('dark');
        }
        
        // Listen for theme changes
        prefersDarkScheme.addEventListener('change', e => {
          if (e.matches) {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        });
      })();
    </script>
    
    <!-- iOS Web App Specific -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-TileColor" content="#4f46e5" />
    <meta name="msapplication-config" content="%PUBLIC_URL%/browserconfig.xml" />
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self'" />
    
    <style>
      /* CSS Custom Properties for safe areas */
      :root {
        --safe-area-top: env(safe-area-inset-top, 0px);
        --safe-area-right: env(safe-area-inset-right, 0px);
        --safe-area-bottom: env(safe-area-inset-bottom, 0px);
        --safe-area-left: env(safe-area-inset-left, 0px);
        --vh: 1vh;
      }
      
      /* Reset and base styles */
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden; /* Prevent default scrolling */
        position: fixed; /* Fix body to prevent scrolling */
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }
      
      /* Prevent blue highlight on mobile taps */
      * {
        -webkit-tap-highlight-color: transparent;
      }
      
      /* Prevent text selection on long press */
      body {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        -webkit-touch-callout: none;
        -webkit-overflow-scrolling: auto; /* Disable momentum scrolling */
        overscroll-behavior: none; /* Disable pull-to-refresh and overscroll effects */
      }
      
      /* Allow text selection in input fields and content areas */
      input, textarea, [contenteditable="true"] {
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }
      
      /* Main app container */
      #root {
        width: 100%;
        height: 100%;
        overflow: auto; /* Allow scrolling inside the app container */
        -webkit-overflow-scrolling: touch; /* Smooth scrolling for iOS */
        position: relative;
        background: #ffffff;
      }
      
      /* Disable pull-to-refresh and overscroll glow */
      #root::-webkit-scrollbar {
        display: none; /* Hide scrollbar but keep functionality */
      }
      
      /* Prevent bounce/overscroll effects on iOS */
      @supports (-webkit-touch-callout: none) {
        body {
          position: fixed;
          width: 100%;
          height: 100%;
          overflow: hidden;
        }
        
        #root {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          -webkit-overflow-scrolling: touch;
          overflow-y: auto;
        }
      }
    </style>
  </head>
  <body>
    <noscript>
      <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; background: white; z-index: 9999; padding: 20px; text-align: center;">
        <div>
          <h1 style="color: #4f46e5; margin-bottom: 20px;">JavaScript Required</h1>
          <p style="color: #666; margin-bottom: 30px; max-width: 400px;">
            CarryOut requires JavaScript to run. Please enable JavaScript in your browser settings to use this application.
          </p>
          <p style="color: #999; font-size: 14px;">
            If you believe this is an error, please refresh the page or contact support.
          </p>
        </div>
      </div>
    </noscript>
    
    <div id="root"></div>
    
    <!-- Touch and scroll event handlers -->
    <script>
      // Variables to track touch events for pull-to-refresh prevention
      let startY = 0;
      let isAtTop = false;
      
      // Prevent pull-to-refresh on touch devices
      document.addEventListener('touchstart', function(e) {
        startY = e.touches[0].clientY;
        isAtTop = window.scrollY === 0;
      }, { passive: true });
      
      document.addEventListener('touchmove', function(e) {
        const currentY = e.touches[0].clientY;
        const diff = currentY - startY;
        
        // If at the top and pulling down, prevent default to disable pull-to-refresh
        if (isAtTop && diff > 0) {
          e.preventDefault();
          return false;
        }
      }, { passive: false });
      
      // Prevent context menu on long press (optional)
      document.addEventListener('contextmenu', function(e) {
        if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
          e.preventDefault();
          return false;
        }
      });
      
      // Prevent text selection on long press (except for input fields)
      document.addEventListener('selectstart', function(e) {
        if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA' && !e.target.isContentEditable) {
          e.preventDefault();
          return false;
        }
      });
      
      // Prevent zoom on double-tap (optional)
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(e) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
          e.preventDefault();
        }
        lastTouchEnd = now;
      }, false);
      
      // Prevent iOS bounce/overscroll effect
      document.addEventListener('touchmove', function(e) {
        if (e.scale !== 1) {
          e.preventDefault();
        }
      }, { passive: false });
      
      // Disable rubber band scrolling on iOS
      document.body.addEventListener('touchmove', function(e) {
        if (this.scrollTop === 0) {
          this.scrollTop = 1;
        } else if (this.scrollHeight - this.scrollTop === this.clientHeight) {
          this.scrollTop -= 1;
        }
      }, false);
      
      // Initialize scroll position to prevent pull-to-refresh
      document.addEventListener('DOMContentLoaded', function() {
        if ('scrollRestoration' in history) {
          history.scrollRestoration = 'manual';
        }
        window.scrollTo(0, 1);
      });
    </script>
  </body>
</html>
